<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DrivePanel - Google Drive Management</title>
    <style>
        /* Reset and base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f5f5;
            color: #333;
        }

        .hidden {
            display: none !important;
        }

        /* cPanel container */
        .cpanel-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        header {
            background-color: #2c3e50;
            color: white;
            padding: 1rem;
            text-align: center;
        }

        header h1 {
            font-size: 1.8rem;
        }

        header p {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .main-content {
            display: flex;
            flex: 1;
        }

        /* Sidebar styles */
        .sidebar {
            width: 250px;
            background-color: #34495e;
            color: white;
            padding: 1rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #4a6278;
        }

        .avatar {
            width: 40px;
            height: 40px;
            background-color: #4a6278;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 0.8rem;
            font-size: 1.2rem;
        }

        nav ul {
            list-style: none;
        }

        nav li {
            margin-bottom: 0.5rem;
        }

        nav li a {
            color: white;
            text-decoration: none;
            display: flex;
            align-items: center;
            padding: 0.5rem;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        nav li a:hover {
            background-color: #4a6278;
        }

        nav li a span {
            margin-right: 0.8rem;
            font-size: 1.1rem;
        }

        nav li.active a {
            background-color: #2980b9;
        }

        /* Content area styles */
        .content-area {
            flex: 1;
            padding: 1.5rem;
            background-color: white;
        }

        .auth-section {
            text-align: center;
            margin-top: 2rem;
        }

        .setup-info {
            background-color: #e8f4fd;
            border: 1px solid #bee5eb;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .setup-info h3 {
            color: #0c5460;
            margin-bottom: 1rem;
        }

        .setup-info ol {
            text-align: left;
            color: #0c5460;
        }

        .setup-info li {
            margin-bottom: 0.5rem;
        }

        .setup-info code {
            background-color: #f8f9fa;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: monospace;
        }

        .btn {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .btn-primary {
            background-color: #2980b9;
            color: white;
        }

        .btn-primary:hover {
            background-color: #3498db;
        }

        .btn-secondary {
            background-color: #ecf0f1;
            color: #2c3e50;
        }

        .btn-secondary:hover {
            background-color: #bdc3c7;
        }

        .btn:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }

        /* Upload section */
        .upload-box {
            border: 2px dashed #bdc3c7;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            margin: 1.5rem 0;
            transition: all 0.2s;
        }

        .upload-box:hover {
            border-color: #2980b9;
        }

        .upload-box p {
            margin-top: 1rem;
            color: #7f8c8d;
        }

        #file-list {
            margin: 1.5rem 0;
        }

        #files-to-upload {
            list-style: none;
            margin: 1rem 0;
        }

        #files-to-upload li {
            padding: 0.5rem;
            border-bottom: 1px solid #ecf0f1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .remove-file {
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-size: 14px;
        }

        .remove-file:hover {
            background-color: #c0392b;
        }

        /* Progress bar */
        .progress-container {
            margin: 1.5rem 0;
        }

        .progress-bar {
            height: 20px;
            background-color: #ecf0f1;
            border-radius: 4px;
            margin: 1rem 0;
            overflow: hidden;
        }

        .progress {
            height: 100%;
            background-color: #27ae60;
            width: 0%;
            transition: width 0.3s;
        }

        /* Drive contents */
        #drive-contents {
            margin-top: 2rem;
        }

        #files-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .file-item {
            border: 1px solid #ecf0f1;
            border-radius: 4px;
            padding: 1rem;
            text-align: center;
            transition: all 0.2s;
        }

        .file-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .file-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .file-name {
            font-size: 0.8rem;
            word-break: break-all;
        }

        .file-size {
            font-size: 0.7rem;
            color: #7f8c8d;
            margin-top: 0.3rem;
        }

        /* Drop zone highlight */
        .highlight {
            border-color: #27ae60 !important;
            background-color: rgba(39, 174, 96, 0.1);
        }

        .error-message {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            border-radius: 4px;
            padding: 1rem;
            margin: 1rem 0;
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="cpanel-container">
        <header>
            <h1>DrivePanel</h1>
            <p>Google Drive Management Interface</p>
        </header>
        
        <div class="main-content">
            <div class="sidebar">
                <div class="user-info">
                    <div class="avatar">üë§</div>
                    <span id="user-email">Not signed in</span>
                </div>
                
                <nav>
                    <ul>
                        <li class="active"><a href="#"><span>üìÅ</span> File Manager</a></li>
                        <li><a href="#"><span>‚¨ÜÔ∏è</span> Upload Files</a></li>
                        <li><a href="#"><span>üîí</span> Security</a></li>
                        <li><a href="#"><span>‚öôÔ∏è</span> Settings</a></li>
                    </ul>
                </nav>
            </div>
            
            <div class="content-area">
                <div class="setup-info">
                    <h3>üîß Setup Required</h3>
                    <p>To use this Google Drive manager, you need to:</p>
                    <ol>
                        <li>Go to <a href="https://console.cloud.google.com/" target="_blank">Google Cloud Console</a></li>
                        <li>Create a new project or select an existing one</li>
                        <li>Enable the Google Drive API</li>
                        <li>Create credentials (OAuth 2.0 Client ID)</li>
                        <li>Add your domain to authorized JavaScript origins</li>
                        <li>Replace the <code>CLIENT_ID</code> and <code>API_KEY</code> in the code below</li>
                    </ol>
                    <p><strong>Note:</strong> This is a demo with placeholder credentials. Real credentials are required for authentication.</p>
                </div>

                <div class="auth-section">
                    <button id="auth-button" class="btn btn-primary" disabled>Sign in with Google</button>
                    <div id="error-message" class="error-message hidden"></div>
                </div>
                
                <div id="upload-section" class="hidden">
                    <h2>Upload Files to Google Drive</h2>
                    <div class="upload-box" id="drop-zone">
                        <input type="file" id="file-input" multiple style="display: none;">
                        <label for="file-input" class="btn btn-secondary">Select Files</label>
                        <p>or drag and drop files here</p>
                    </div>
                    
                    <div id="file-list" class="hidden">
                        <h3>Selected Files</h3>
                        <ul id="files-to-upload"></ul>
                        <button id="upload-button" class="btn btn-primary">Upload to Drive</button>
                    </div>
                    
                    <div id="progress-container" class="hidden">
                        <h3>Upload Progress</h3>
                        <div class="progress-bar">
                            <div id="progress" class="progress"></div>
                        </div>
                        <p id="status-message"></p>
                    </div>
                </div>
                
                <div id="drive-contents" class="hidden">
                    <h2>Your Drive Files</h2>
                    <div id="files-container"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://accounts.google.com/gsi/client"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <script>
        // Google API configuration - REPLACE THESE WITH YOUR ACTUAL CREDENTIALS
        const API_KEY = 'AIzaSyB6rE__c8EXX0eacdZEg6_1RZKQSEp6jNo'; // Replace with your actual API key
        const CLIENT_ID = '176471486426-oj4tmfejj9ollhm3ef0o0m3l6shctuhh.apps.googleusercontent.com'; // Replace with your actual client ID
        const DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/drive/v3/rest';
        const SCOPES = 'https://www.googleapis.com/auth/drive.file';

        // DOM elements
        const authButton = document.getElementById('auth-button');
        const uploadSection = document.getElementById('upload-section');
        const driveContents = document.getElementById('drive-contents');
        const fileInput = document.getElementById('file-input');
        const filesToUpload = document.getElementById('files-to-upload');
        const uploadButton = document.getElementById('upload-button');
        const dropZone = document.getElementById('drop-zone');
        const fileList = document.getElementById('file-list');
        const progressContainer = document.getElementById('progress-container');
        const progress = document.getElementById('progress');
        const statusMessage = document.getElementById('status-message');
        const userEmail = document.getElementById('user-email');
        const errorMessage = document.getElementById('error-message');

        let selectedFiles = [];
        let tokenClient;
        let gapi_inited = false;
        let gis_inited = false;

        // Check if credentials are properly configured
        function checkCredentials() {
            if (API_KEY === 'YOUR_API_KEY_HERE' || CLIENT_ID === 'YOUR_CLIENT_ID_HERE.apps.googleusercontent.com') {
                showError('Please replace the placeholder API_KEY and CLIENT_ID with your actual Google Cloud credentials.');
                return false;
            }
            return true;
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.classList.remove('hidden');
        }

        function hideError() {
            errorMessage.classList.add('hidden');
        }

        // Initialize Google API
        async function gapiLoaded() {
            if (!checkCredentials()) return;
            
            try {
                await gapi.load('client', initializeGapiClient);
            } catch (error) {
                showError('Failed to load Google API client: ' + error.message);
            }
        }

        async function initializeGapiClient() {
            try {
                await gapi.client.init({
                    apiKey: API_KEY,
                    discoveryDocs: [DISCOVERY_DOC],
                });
                gapi_inited = true;
                maybeEnableButtons();
            } catch (error) {
                showError('Failed to initialize Google API client: ' + error.message);
            }
        }

        function gisLoaded() {
            if (!checkCredentials()) return;
            
            try {
                tokenClient = google.accounts.oauth2.initTokenClient({
                    client_id: CLIENT_ID,
                    scope: SCOPES,
                    callback: '', // defined later
                });
                gis_inited = true;
                maybeEnableButtons();
            } catch (error) {
                showError('Failed to initialize Google Identity Services: ' + error.message);
            }
        }

        function maybeEnableButtons() {
            if (gapi_inited && gis_inited && checkCredentials()) {
                authButton.disabled = false;
                hideError();
            }
        }

        // Authentication
        function handleAuthClick() {
            tokenClient.callback = async (resp) => {
                if (resp.error !== undefined) {
                    showError('Authentication failed: ' + resp.error);
                    return;
                }
                
                try {
                    await handleAuthSuccess();
                } catch (error) {
                    showError('Authentication error: ' + error.message);
                }
            };

            if (gapi.client.getToken() === null) {
                tokenClient.requestAccessToken({prompt: 'consent'});
            } else {
                tokenClient.requestAccessToken({prompt: ''});
            }
        }

        async function handleAuthSuccess() {
            authButton.style.display = 'none';
            uploadSection.classList.remove('hidden');
            driveContents.classList.remove('hidden');
            userEmail.textContent = 'Loading...';
            
            try {
                // Get user info
                const response = await gapi.client.drive.about.get({
                    fields: 'user'
                });
                userEmail.textContent = response.result.user.emailAddress;
                await listDriveFiles();
            } catch (error) {
                showError('Failed to get user information: ' + error.message);
                userEmail.textContent = 'Error loading user info';
            }
        }

        // File selection
        fileInput.addEventListener('change', handleFileSelect);
        uploadButton.addEventListener('click', handleUpload);

        function handleFileSelect(event) {
            selectedFiles = Array.from(event.target.files);
            updateFileList();
        }

        function updateFileList() {
            filesToUpload.innerHTML = '';
            
            if (selectedFiles.length === 0) {
                fileList.classList.add('hidden');
                return;
            }
            
            fileList.classList.remove('hidden');
            
            selectedFiles.forEach((file, index) => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <span>${file.name} (${formatFileSize(file.size)})</span>
                    <button class="remove-file" data-index="${index}">√ó</button>
                `;
                filesToUpload.appendChild(li);
            });
            
            // Add event listeners to remove buttons
            document.querySelectorAll('.remove-file').forEach(button => {
                button.addEventListener('click', (e) => {
                    const index = parseInt(e.target.getAttribute('data-index'));
                    selectedFiles.splice(index, 1);
                    updateFileList();
                });
            });
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Drag and drop
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('highlight');
        });

        dropZone.addEventListener('dragleave', (e) => {
            e.preventDefault();
            dropZone.classList.remove('highlight');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('highlight');
            
            if (e.dataTransfer.files.length) {
                selectedFiles = Array.from(e.dataTransfer.files);
                updateFileList();
            }
        });

        // File upload using multipart upload
        async function handleUpload() {
            if (selectedFiles.length === 0) return;
            
            fileList.classList.add('hidden');
            progressContainer.classList.remove('hidden');
            statusMessage.textContent = 'Preparing upload...';
            
            let uploadedCount = 0;
            const totalFiles = selectedFiles.length;
            
            for (const file of selectedFiles) {
                try {
                    statusMessage.textContent = `Uploading ${file.name}...`;
                    
                    await uploadFile(file);
                    
                    uploadedCount++;
                    const percent = Math.round((uploadedCount / totalFiles) * 100);
                    progress.style.width = `${percent}%`;
                    
                    if (uploadedCount === totalFiles) {
                        statusMessage.textContent = 'Upload complete!';
                        setTimeout(() => {
                            selectedFiles = [];
                            progressContainer.classList.add('hidden');
                            progress.style.width = '0%';
                            listDriveFiles();
                        }, 2000);
                    }
                    
                } catch (error) {
                    console.error('Upload error:', error);
                    statusMessage.textContent = `Error uploading ${file.name}: ${error.message}`;
                    break;
                }
            }
        }

        async function uploadFile(file) {
            const metadata = {
                name: file.name,
            };

            const form = new FormData();
            form.append('metadata', new Blob([JSON.stringify(metadata)], {type: 'application/json'}));
            form.append('file', file);

            const response = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
                method: 'POST',
                headers: new Headers({
                    'Authorization': `Bearer ${gapi.client.getToken().access_token}`
                }),
                body: form
            });

            if (!response.ok) {
                throw new Error(`Upload failed: ${response.statusText}`);
            }

            return response.json();
        }

        // List Drive files
        async function listDriveFiles() {
            try {
                const response = await gapi.client.drive.files.list({
                    pageSize: 20,
                    fields: 'files(id, name, mimeType, size, createdTime)',
                    orderBy: 'createdTime desc'
                });
                
                const files = response.result.files;
                const filesContainer = document.getElementById('files-container');
                filesContainer.innerHTML = '';
                
                if (files && files.length > 0) {
                    files.forEach(file => {
                        const fileItem = document.createElement('div');
                        fileItem.className = 'file-item';
                        
                        const icon = getFileIcon(file.mimeType);
                        const size = file.size ? formatFileSize(parseInt(file.size)) : 'N/A';
                        
                        fileItem.innerHTML = `
                            <div class="file-icon">${icon}</div>
                            <div class="file-name" title="${file.name}">${file.name}</div>
                            <div class="file-size">${size}</div>
                        `;
                        
                        filesContainer.appendChild(fileItem);
                    });
                } else {
                    filesContainer.innerHTML = '<p>No files found in your Drive.</p>';
                }
            } catch (error) {
                showError('Failed to load Drive files: ' + error.message);
                document.getElementById('files-container').innerHTML = '<p>Error loading files.</p>';
            }
        }

        function getFileIcon(mimeType) {
            if (!mimeType) return 'üìÑ';
            
            if (mimeType.includes('folder')) return 'üìÅ';
            if (mimeType.includes('image')) return 'üñºÔ∏è';
            if (mimeType.includes('video')) return 'üé¨';
            if (mimeType.includes('audio')) return 'üéµ';
            if (mimeType.includes('pdf')) return 'üìï';
            if (mimeType.includes('word')) return 'üìù';
            if (mimeType.includes('excel') || mimeType.includes('spreadsheet')) return 'üìä';
            if (mimeType.includes('powerpoint') || mimeType.includes('presentation')) return 'üìë';
            if (mimeType.includes('zip') || mimeType.includes('compressed')) return 'üóúÔ∏è';
            
            return 'üìÑ';
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            authButton.addEventListener('click', handleAuthClick);
            
            // Load Google APIs
            gapiLoaded();
            gisLoaded();
        });
    </script>
</body>
</html>
